{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

<div class="{{ include.type | default: "list" }}__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">

    <!-- Title, Authors, and Link -->
    <p>
      <strong>
        {% if post.pdf %}
          <a href="{{ post.pdf }}">{{ title }}</a>
        {% else %}
          {{ title }}
        {% endif %}
      </strong>
      {% assign authors = post.co-authors | join: ", " | strip_newlines | replace: " ,", "," | replace: ", ,", "," | replace: ", ,", "," %}
      {% if authors != "" %}
        <span> - With {{ authors }}. {{ post.year }}.</span>
      {% else %}
        <span> - {{ post.year }}.</span>
      {% endif %}
    </p>

    <!-- Link to Publication Page and Copy Citation to Clipboard -->
    <div style="display: inline-block;">
      {% if post.published_link %}
        <button onclick="window.open('{{ post.published_link }}', '_blank')">Link</button>
      {% else %}
        <button disabled>Link</button>
      {% endif %}
    </div>
    <div style="display: inline-block;">
      {% if post.apa_citation %}
        <button onclick="copyToClipboard('{{ post.apa_citation | escape }}')">Cite this</button>
      {% endif %}
    </div>

    <!-- Disciplines (if available) -->
    {% if post.group %}
      <p><strong>Disciplines:</strong> {{ post.group }}</p>
    {% endif %}

  </article>
</div>

<script>
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
      alert('Citation copied to clipboard'); // maybe this is not needed but we'll keep it here for now
    }, function(err) {
      console.error('Could not copy text: ', err);
    });
  }
</script>